<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adaptive Platform Demonstrator: Building a minimal yocto image</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adaptive Platform Demonstrator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('asrbuild_introduction.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Building a minimal yocto image </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Essentials: Packages needed to build an image on a headless system: <div class="fragment"><div class="line">$ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \</div><div class="line">   build-essential chrpath socat cpio python python3 python3-pip python3-pexpect \</div><div class="line">   xz-utils debianutils iputils-ping</div></div><!-- fragment --> <blockquote class="doxtable">
<p>Note: If your build system has the oss4-dev package installed, you might experience QEMU build failures due to the package installing its own custom /usr/include/linux/soundcard.h on the Debian system. If you run into this situation, either of the following solutions exist: </p>
</blockquote>
<div class="fragment"><div class="line">$ sudo apt-get build-dep qemu</div><div class="line">$ sudo apt-get remove oss4-dev</div></div><!-- fragment --></li>
<li>Clone the poky from git repository and checkout to latest branch <div class="fragment"><div class="line">$ git clone http://git.yoctoproject.org/git/poky</div><div class="line">$ cd poky</div><div class="line">$ git checkout tags/yocto-2.4 -b poky_2.4</div></div><!-- fragment --></li>
<li>Clone the Intel-corei7-64 BSP for the rocko image in Poky dir <div class="fragment"><div class="line">$ git clone git://git.yoctoproject.org/meta-intel</div><div class="line">$ cd $HOME/poky/meta-intel</div><div class="line">$ git checkout tags/8.0-rocko-2.4.2 -b meta-intel-rocko-2.4.2</div></div><!-- fragment --></li>
<li>Configure the build in local.conf and bblayers.conf <div class="fragment"><div class="line">$ cd $HOME/poky/build</div><div class="line">$ bitbake-layers add-layer &quot;$HOME/poky/meta-intel&quot;</div><div class="line">$ echo &#39;MACHINE = &quot;intel-corei7-64&quot;&#39; &gt;&gt; conf/local.conf</div></div><!-- fragment --></li>
<li>Bitbake the image <div class="fragment"><div class="line">$ cd $home/poky/</div><div class="line">$ source oe-init-build-env</div><div class="line">$ bitbake core-image-base</div></div><!-- fragment --></li>
<li>Run the image on qemu for thatyou shoul change the machine to "qemux86" in local.conf before bitbake <div class="fragment"><div class="line">$ runqemu qemux86 core-image-base</div></div><!-- fragment --></li>
<li>Flash the image into USB to execute the image on minnow board, so skip the above step <div class="fragment"><div class="line">$ sudo dd if=tmp/deploy/images/intel-corei7-64/core-image-base-intel-corei7-64.hddimg   of=/dev/sdb</div></div><!-- fragment --></li>
</ul>
<h1>Creating a hello world program</h1>
<ul>
<li>Create a meta-mylayer for helloworld program in poky dir <div class="fragment"><div class="line">$ cd $home/poky/</div><div class="line">$ source oe-init-build-env</div><div class="line">$ cd ..</div><div class="line">$ yocto-layer create mylayer</div></div><!-- fragment --></li>
</ul>
<blockquote class="doxtable">
<p>Note: when asked for example recipe creation : yes </p>
</blockquote>
<blockquote class="doxtable">
<p>When askd for recipe name : helloworld </p>
</blockquote>
<ul>
<li>Ads the meta-mylayer in bblayer.conf <div class="fragment"><div class="line">$ bitbake-layers add-layer &quot;$HOME/poky/meta-mylayer&quot; </div></div><!-- fragment --></li>
<li>Add the helloworld in local.conf <div class="fragment"><div class="line">$ echo ‘IMAGE_INSTALL_append = “ helloworld”&#39; &gt;&gt; conf/local.conf</div></div><!-- fragment --></li>
<li>Bitbake the helloworld program <div class="fragment"><div class="line">$ bitbake helloworld</div></div><!-- fragment --></li>
<li>Bitbake the image <div class="fragment"><div class="line">$ bitbake core-image-base</div></div><!-- fragment --></li>
<li>After flashing the image into USB, boot the image on board. To execute the hello world, type the command on target terminal , helloworld bin file will be in /usr/bin <div class="fragment"><div class="line">$ /usr/bin/helloworld</div></div><!-- fragment --></li>
</ul>
<h1>Creating a program for LED blinking</h1>
<ul>
<li>Create a meta-mylayer for helloworld program in poky dir <div class="fragment"><div class="line">$ cd $home/poky/</div><div class="line">$ source oe-init-build-env</div><div class="line">$ cd ..</div><div class="line">$ yocto-layer create mylayer</div></div><!-- fragment --></li>
</ul>
<blockquote class="doxtable">
<p>Note: when asked for example recipe creation : yes </p>
</blockquote>
<blockquote class="doxtable">
<p>When askd for recipe name : leblink </p>
</blockquote>
<ul>
<li>Remove helloworld program and add ledblink.c</li>
</ul>
<blockquote class="doxtable">
<p>$ vi ledblink.c </p>
</blockquote>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> LedExport(<span class="keywordtype">void</span>);</div><div class="line"><span class="keywordtype">int</span> LedDirection(<span class="keywordtype">void</span>);</div><div class="line"><span class="keywordtype">int</span> LedToggle(<span class="keywordtype">void</span>);</div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;Hellow Let&#39;s Blink LED\r\n&quot;</span>);</div><div class="line">    <span class="keywordtype">int</span> repeat = 9;</div><div class="line"></div><div class="line">     LedExport();</div><div class="line">     LedDirection();</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(repeat--)</div><div class="line">    {</div><div class="line">        LedToggle();</div><div class="line">        usleep(500*100);</div><div class="line">        LedToggle();</div><div class="line">        usleep(500*100);    </div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span>(0);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> LedExport(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    FILE *fd;</div><div class="line">        usleep(500*100);        </div><div class="line">        fd = fopen(<span class="stringliteral">&quot;/sys/class/gpio/export&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(NULL == fd)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Failed to open export\r\n&quot;</span>);</div><div class="line">        }       </div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;export file opened\r\n&quot;</span>);</div><div class="line">                fputs(<span class="stringliteral">&quot;360&quot;</span>, fd);</div><div class="line"></div><div class="line">                fclose(fd);</div><div class="line">        }</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> LedDirection(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    FILE *fd;</div><div class="line">        usleep(500*100);</div><div class="line">        fd = fopen(<span class="stringliteral">&quot;/sys/class/gpio/gpio360/direction&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(NULL == fd)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Failed to open direction\r\n&quot;</span>);</div><div class="line">        }       </div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;direction file opened\r\n&quot;</span>);</div><div class="line">                fputs(<span class="stringliteral">&quot;out&quot;</span>, fd);</div><div class="line"></div><div class="line">                fclose(fd);</div><div class="line">        }</div><div class="line"></div><div class="line">}</div><div class="line"><span class="keywordtype">int</span> LedToggle(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> tog = 0;</div><div class="line"></div><div class="line">    FILE *fd;</div><div class="line">        usleep(500*100);</div><div class="line">        fd = fopen(<span class="stringliteral">&quot;/sys/class/gpio/gpio360/value&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(NULL == fd)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Failed to open value\r\n&quot;</span>);</div><div class="line">        }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (tog)</div><div class="line">        {       </div><div class="line">            fputs(<span class="stringliteral">&quot;1&quot;</span>, fd);</div><div class="line">            tog = 0;</div><div class="line"></div><div class="line">        }<span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            fputs(<span class="stringliteral">&quot;0&quot;</span>, fd);</div><div class="line">            tog = 1;    </div><div class="line">        }</div><div class="line">        fclose(fd);</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><ul>
<li>Create CMakeLists.txt file <div class="fragment"><div class="line">add_executable(led ledblink.c)</div><div class="line"></div><div class="line">install(TARGETS led RUNTIME DESTINATION opt/led/bin)</div></div><!-- fragment --></li>
<li>Edit the ledblink.bb file <div class="fragment"><div class="line">#</div><div class="line"># This file was derived from the &#39;Hello World!&#39; example recipe in the</div><div class="line"># Yocto Project Development Manual.</div><div class="line">#</div><div class="line"></div><div class="line">DESCRIPTION = &quot;Simple ledblink application&quot;</div><div class="line">SECTION = &quot;examples&quot;</div><div class="line">LICENSE = &quot;MIT&quot;</div><div class="line">LIC_FILES_CHKSUM = &quot;file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&quot;</div><div class="line">PR = &quot;r0&quot;</div><div class="line"></div><div class="line">SRC_URI = &quot;path to /CMakeList.txt&quot;</div><div class="line">inherit cmake</div></div><!-- fragment --></li>
<li>Add the meta-mylayer in bblayer.conf <div class="fragment"><div class="line">$ bitbake-layers add-layer &quot;$HOME/poky/meta-mylayer&quot; </div></div><!-- fragment --></li>
<li>Add the helloworld in local.conf <div class="fragment"><div class="line">$ echo ‘IMAGE_INSTALL_append = “ ledblink”&#39; &gt;&gt; conf/local.conf</div></div><!-- fragment --></li>
<li>Bitbake the ledblink program <div class="fragment"><div class="line">$ bitbake ledblink</div></div><!-- fragment --></li>
<li>Bitbake the image <div class="fragment"><div class="line">$ bitbake core-image-base</div></div><!-- fragment --></li>
<li>After flashing the image into USB, boot the image on board. To execute the hello world, type the command on target terminal , ledblink bin file will be in /usr/bin <div class="fragment"><div class="line">$ /usr/bin/ledblink</div></div><!-- fragment --></li>
</ul>
<h1>Add ledblink in core-image-minimal</h1>
<ul>
<li>goto directory poky/meta/recipes-core/images <blockquote class="doxtable">
<p>$ cd poky/meta/recipes-core/images </p>
</blockquote>
</li>
<li>open core-image-minimal.bbfile <blockquote class="doxtable">
<p>$ vi core-image-minimal.bb </p>
</blockquote>
</li>
<li>Add the follow at the end in core-image-minimal.bb file to add ledblink application <blockquote class="doxtable">
<p>IMAGE_INSTALL += " ledblink"</p>
</blockquote>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="asrbuild_root.html">Build Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
