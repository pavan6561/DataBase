<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adaptive Platform Demonstrator: Execution Management practical</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adaptive Platform Demonstrator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_execution_practical.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Execution Management practical </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Creating an Adaptive Application</h2>
<h3>Creating new layer for adaptive platform</h3>
<p>Create a meta-mylayer for demo program in ara-project dir </p><blockquote class="doxtable">
<p>$ cd ara-project </p>
</blockquote>
<blockquote class="doxtable">
<p>$ source poky/oe-init-build-env </p>
</blockquote>
<blockquote class="doxtable">
<p>$ cd .. </p>
</blockquote>
<blockquote class="doxtable">
<p>$ yocto-layer create mylayer </p>
</blockquote>
<div class="fragment"><div class="line">Note: when asked for example recipe creation : yes</div><div class="line">   When askd for recipe name             :  demo</div></div><!-- fragment --><h3>Editing bblayer.conf</h3>
<p>Add the meta-mylayer in bblayer.conf </p><blockquote class="doxtable">
<p>$ bitbake-layers add-layer "$HOME/ara-project/meta-mylayer" </p>
</blockquote>
<h3>Adding test program in test.cpp and test_main.cpp</h3>
<p>Go to meta-mylayer/recipes-exzmple/example/demo-0.1 and remove the helloworld.c and add test.cpp and test_main.cpp </p><blockquote class="doxtable">
<p>$ rm hello.c </p>
</blockquote>
<blockquote class="doxtable">
<p>$ vi test.cpp </p>
</blockquote>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;exec/state_client.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;exec/application_client.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libplatform/utility.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define TRACE(str) if (trace) { std::cout &lt;&lt; str &lt;&lt; std::endl; }</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> trace = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> RegMachineStateTimeOut = 300;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> GetMachineStateTimeOut = 10000;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> SetMachineStateTimeOut = 20000;</div><div class="line"></div><div class="line"><span class="keyword">const</span> std::string ErrorCode[] = {</div><div class="line">    <span class="stringliteral">&quot;Success&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Invalid state requested&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Machine state change is ongoing, all request received during the change are invalid&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;No client registered previously&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Timeout on machine state operation&quot;</span></div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> i = 0, loop_counter;</div><div class="line">    <span class="keywordtype">bool</span> shuttingDownEnabled = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    std::string state;</div><div class="line">    std::string fifo(<span class="stringliteral">&quot;/run/sysstate-client-fifo&quot;</span>);</div><div class="line"></div><div class="line">    std::string appl(*argv);</div><div class="line">    std::string path(appl);</div><div class="line">    path = path.substr(0, path.find_last_of(<span class="stringliteral">&quot;/&quot;</span>));</div><div class="line">    path = path.substr(0, path.find_last_of(<span class="stringliteral">&quot;/&quot;</span>));</div><div class="line"></div><div class="line">    ara::exec::StateClient state_client;</div><div class="line"></div><div class="line">    ara::exec::ApplicationClient app_client;</div><div class="line">    <span class="keywordflow">if</span>(app_client.ReportApplicationState(ara::exec::ApplicationState::kRunning)</div><div class="line">            == ara::exec::ApplicationReturnType::kGeneralError)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Failed to report ApplicationState::kRunning.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Successfully reported ApplicationState::kRunning.&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Start of Test Application: &quot;</span> &lt;&lt; appl &lt;&lt; std::endl;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    ara::exec::StateReturnType er = state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">    <span class="keywordflow">if</span> (er == ara::exec::StateReturnType::kSuccess)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Got Machine State: &quot;</span> &lt;&lt; state);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error getting Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er)]);</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    sleep(20);  </div><div class="line">    <span class="keywordflow">if</span> (appl == <span class="stringliteral">&quot;/opt/Parking/bin/Parking&quot;</span>)</div><div class="line">    {</div><div class="line">        sleep(120); </div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(app_client.ReportApplicationState(ara::exec::ApplicationState::kTerminating)</div><div class="line">            == ara::exec::ApplicationReturnType::kGeneralError)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Failed to report ApplicationState::kTerminating.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Successfully reported ApplicationState::kTerminating.&quot;</span>);</div><div class="line">    }</div><div class="line">    TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; successfully exits.&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> <blockquote class="doxtable">
<p>$ vi test_main.cpp </p>
</blockquote>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;exec/state_client.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;exec/application_client.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libplatform/utility.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define TRACE(str) if (trace) { std::cout &lt;&lt; str &lt;&lt; std::endl; }</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> trace = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> RegMachineStateTimeOut = 300;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> GetMachineStateTimeOut = 10000;</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> SetMachineStateTimeOut = 20000;</div><div class="line"></div><div class="line"><span class="keyword">const</span> std::string ErrorCode[] = {</div><div class="line">    <span class="stringliteral">&quot;Success&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Invalid state requested&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Machine state change is ongoing, all request received during the change are invalid&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;No client registered previously&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;Timeout on machine state operation&quot;</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> changeMachineState(</div><div class="line">    ara::exec::StateClient&amp; state_client,</div><div class="line">    <span class="keyword">const</span> std::string&amp; appl,</div><div class="line">    <span class="keyword">const</span> std::string&amp; strState)</div><div class="line">{</div><div class="line">    std::string curState;</div><div class="line"></div><div class="line">    ara::exec::StateReturnType er = state_client.GetState(GetMachineStateTimeOut, curState);</div><div class="line">    <span class="keywordflow">if</span> (er == ara::exec::StateReturnType::kSuccess)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (curState == strState)</div><div class="line">        {</div><div class="line">            TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Machine State is already in &quot;</span> &lt;&lt; curState);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        er = state_client.SetState(strState, SetMachineStateTimeOut);</div><div class="line">        <span class="keywordflow">if</span> (er == ara::exec::StateReturnType::kSuccess)</div><div class="line">        {</div><div class="line">            TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Machine State successfully changed to &quot;</span> &lt;&lt; strState);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }<span class="keywordflow">else</span>{</div><div class="line"></div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error changing Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er)]);</div><div class="line"></div><div class="line">        }   </div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error getting Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er)]);</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> i = 0, loop_counter;</div><div class="line">    <span class="keywordtype">bool</span> shuttingDownEnabled = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    std::string state;</div><div class="line">    std::string fifo(<span class="stringliteral">&quot;/run/sysstate-client-fifo&quot;</span>);</div><div class="line"></div><div class="line">    std::string appl(*argv);</div><div class="line">    std::string path(appl);</div><div class="line">    path = path.substr(0, path.find_last_of(<span class="stringliteral">&quot;/&quot;</span>));</div><div class="line">    path = path.substr(0, path.find_last_of(<span class="stringliteral">&quot;/&quot;</span>));</div><div class="line"></div><div class="line">    ara::exec::StateClient state_client;</div><div class="line"></div><div class="line">    ara::exec::ApplicationClient app_client;</div><div class="line">    <span class="keywordflow">if</span>(app_client.ReportApplicationState(ara::exec::ApplicationState::kRunning)</div><div class="line">            == ara::exec::ApplicationReturnType::kGeneralError)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Failed to report ApplicationState::kRunning.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Successfully reported ApplicationState::kRunning.&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Start of Test Application: &quot;</span> &lt;&lt; appl &lt;&lt; std::endl;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    ara::exec::StateReturnType er = state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">    <span class="keywordflow">if</span> (er == ara::exec::StateReturnType::kSuccess)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Got Machine State: &quot;</span> &lt;&lt; state);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error getting Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er)]);</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">{</div><div class="line"></div><div class="line">    sleep(20);  </div><div class="line"></div><div class="line">    ara::exec::StateReturnType er1 = state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">    <span class="keywordflow">if</span> (er1 == ara::exec::StateReturnType::kSuccess)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App111 &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Got Machine State: &quot;</span> &lt;&lt; state);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (((state ==  <span class="stringliteral">&quot;Leaving&quot;</span>)||(state ==  <span class="stringliteral">&quot;Startup&quot;</span>)) &amp;&amp;(!changeMachineState(state_client, appl, <span class="stringliteral">&quot;Driving&quot;</span>)))</div><div class="line">        {</div><div class="line">            state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">            TRACE(<span class="stringliteral">&quot;Test App 1111111 &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; ChangeMachineState.&quot;</span>&lt;&lt; state);</div><div class="line"></div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error getting Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er1)]);</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">     sleep(20);</div><div class="line"></div><div class="line"></div><div class="line">    er1 = state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">    <span class="keywordflow">if</span> (er1 == ara::exec::StateReturnType::kSuccess)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App2222 &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Got Machine State: &quot;</span> &lt;&lt; state);</div><div class="line">        <span class="keywordflow">if</span> ((state == <span class="stringliteral">&quot;Driving&quot;</span>) &amp;&amp; (!changeMachineState(state_client, appl, <span class="stringliteral">&quot;Parking&quot;</span>)))</div><div class="line">        {</div><div class="line">            state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">            TRACE(<span class="stringliteral">&quot;Test App222222&quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; ChangeMachineState.&quot;</span>&lt;&lt; state);</div><div class="line">        }   </div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error getting Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er1)]);</div><div class="line">    }</div><div class="line"></div><div class="line">    sleep(20);</div><div class="line"></div><div class="line"></div><div class="line">    er1 = state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">    <span class="keywordflow">if</span> (er1 == ara::exec::StateReturnType::kSuccess)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App3333 &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Got Machine State: &quot;</span> &lt;&lt; state);</div><div class="line">        <span class="keywordflow">if</span> ((state == <span class="stringliteral">&quot;Parking&quot;</span>) &amp;&amp; (!changeMachineState(state_client, appl, <span class="stringliteral">&quot;Leaving&quot;</span>)))</div><div class="line">        {</div><div class="line">            state_client.GetState(GetMachineStateTimeOut, state);</div><div class="line">            TRACE(<span class="stringliteral">&quot;Test App3333&quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; ChangeMachineState.&quot;</span>&lt;&lt; state);</div><div class="line">        }   </div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Error getting Machine State! &quot;</span> &lt;&lt; ErrorCode[static_cast&lt;int&gt;(er1)]);</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(app_client.ReportApplicationState(ara::exec::ApplicationState::kTerminating)</div><div class="line">            == ara::exec::ApplicationReturnType::kGeneralError)</div><div class="line">    {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Failed to report ApplicationState::kTerminating.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; - Successfully reported ApplicationState::kTerminating.&quot;</span>);</div><div class="line">    }</div><div class="line">    TRACE(<span class="stringliteral">&quot;Test App &quot;</span> &lt;&lt; appl &lt;&lt; <span class="stringliteral">&quot; successfully exits.&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> <h3>Creating Cmake file</h3>
<p>Add Cmake file where our source file resides.</p>
<blockquote class="doxtable">
<p>$ vi CMakeLists.txt </p>
</blockquote>
<div class="fragment"><div class="line">set(CMAKE_CXX_STANDARD 11)</div><div class="line"></div><div class="line">find_package(ARAExec REQUIRED)</div><div class="line">find_package(AdaptivePlatform REQUIRED)</div><div class="line"></div><div class="line">add_executable(testapp test_main.cpp)</div><div class="line">add_executable(Driving test.cpp)</div><div class="line">add_executable(Parking test.cpp)</div><div class="line">add_executable(Leaving test.cpp)</div><div class="line"></div><div class="line">target_link_libraries(testapp ${ARAEXEC_LIBRARIES} ${ADAPTIVEPLATFORM_LIBRARIES})</div><div class="line">target_link_libraries(Driving ${ARAEXEC_LIBRARIES} ${ADAPTIVEPLATFORM_LIBRARIES})</div><div class="line">target_link_libraries(Parking ${ARAEXEC_LIBRARIES} ${ADAPTIVEPLATFORM_LIBRARIES})</div><div class="line">target_link_libraries(Leaving ${ARAEXEC_LIBRARIES} ${ADAPTIVEPLATFORM_LIBRARIES})</div><div class="line"></div><div class="line"></div><div class="line">install(TARGETS testapp RUNTIME DESTINATION opt/testapp/bin)</div><div class="line">install(FILES MANIFST-demo1.json PERMISSIONS OWNER_READ GROUP_READ WORLD_READ DESTINATION opt/testapp/etc RENAME MANIFEST.json)</div><div class="line"></div><div class="line">install(TARGETS Driving RUNTIME DESTINATION opt/Driving/bin)</div><div class="line">install(FILES MANIFEST-appl1.json PERMISSIONS OWNER_READ GROUP_READ WORLD_READ DESTINATION opt/Driving/etc RENAME MANIFEST.json)</div><div class="line"></div><div class="line">install(TARGETS Parking RUNTIME DESTINATION opt/Parking/bin)</div><div class="line">install(FILES MANIFEST-appl2.json PERMISSIONS OWNER_READ GROUP_READ WORLD_READ DESTINATION opt/Parking/etc RENAME MANIFEST.json)</div><div class="line"></div><div class="line">install(TARGETS Leaving RUNTIME DESTINATION opt/Leaving/bin)</div><div class="line">install(FILES MANIFEST-appl3.json PERMISSIONS OWNER_READ GROUP_READ WORLD_READ DESTINATION opt/Leaving/etc RENAME MANIFEST.json)</div></div><!-- fragment --><h3>Creating MANIFEST file for our eecutables</h3>
<p>Add different manifest file for each executable with different state i,e driving parking leaving etc in Machine and strings.</p>
<blockquote class="doxtable">
<p>$ vi MANIFST-demo1.json </p>
</blockquote>
<div class="fragment"><div class="line"> [</div><div class="line">    {</div><div class="line">        &quot;key&quot;: &quot;platform_application&quot;,</div><div class="line">        &quot;value&quot;: {</div><div class="line">            &quot;bool&quot;: false</div><div class="line">        },</div><div class="line">        &quot;checksum&quot;: 1639441683</div><div class="line">    },</div><div class="line">    {</div><div class="line">        &quot;key&quot;: &quot;application_states&quot;,</div><div class="line">        &quot;value&quot;: {</div><div class="line">            &quot;string[]&quot;: [ ]</div><div class="line">        },</div><div class="line">        &quot;checksum&quot;: 1639441683</div><div class="line">    },</div><div class="line">    {</div><div class="line">        &quot;key&quot;: &quot;timer_resolution_ns&quot;,</div><div class="line">        &quot;value&quot;: {</div><div class="line">            &quot;uint32&quot;: 1000</div><div class="line">        },</div><div class="line">        &quot;checksum&quot;: 1405615546</div><div class="line">    },</div><div class="line">    {</div><div class="line">        &quot;key&quot;: &quot;startup_configs&quot;,</div><div class="line">        &quot;value&quot;: {</div><div class="line">            &quot;object[]&quot;: [</div><div class="line">                {</div><div class="line">                    &quot;key&quot;: &quot;Machine: Startup, Driving, Parking&quot;,</div><div class="line">                    &quot;value&quot;: {</div><div class="line">                        &quot;object[]&quot;: [</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;depends&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;string[]&quot;: [ ]</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            },</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;machine_states&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;string[]&quot;: [ &quot;Startup&quot;, &quot;Driving&quot;, &quot;Parking&quot; ]</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            },</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;function_group_states&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;string[]&quot;: [ ]</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            },</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;resource_group&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;string&quot;: &quot;Resource group 1&quot;</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            },</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;scheduling_policy&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;string&quot;: &quot;Round Robin&quot;</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            },</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;scheduling_priority&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;uint32&quot;: 12</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            },</div><div class="line">                            {</div><div class="line">                                &quot;key&quot;: &quot;arguments&quot;,</div><div class="line">                                &quot;value&quot;: {</div><div class="line">                                    &quot;string[]&quot;: [ &quot;--dbg&quot;, &quot;arg2&quot;, &quot;arg3&quot; ]</div><div class="line">                                },</div><div class="line">                                &quot;checksum&quot;: 2301152528</div><div class="line">                            }</div><div class="line">                        ]</div><div class="line">                    },</div><div class="line">                    &quot;checksum&quot;: 870226170</div><div class="line">                }</div><div class="line">            ]</div><div class="line">        },</div><div class="line">        &quot;checksum&quot;: 870226170</div><div class="line">    }</div><div class="line">]</div></div><!-- fragment --><h3>Editing the bb file</h3>
<p>Edit the demo_0.1.bb file</p>
<blockquote class="doxtable">
<p>$ vi demo_0.1.bb </p>
</blockquote>
<div class="fragment"><div class="line">#</div><div class="line"># This file was derived from the &#39;Hello World!&#39; example recipe in the</div><div class="line"># Yocto Project Development Manual.</div><div class="line">#</div><div class="line"></div><div class="line">SUMMARY = &quot;Adative application&quot;</div><div class="line">SECTION = &quot;examples&quot;</div><div class="line">LICENSE = &quot;MIT&quot;</div><div class="line">LIC_FILES_CHKSUM = &quot;file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&quot;</div><div class="line"></div><div class="line">inherit externalsrc</div><div class="line">EXTERNALSRC := &quot;${THISDIR}/../../../../build/meta-layer/recipes-example/example/layer-0.1&quot;</div><div class="line"></div><div class="line">DEPENDS = &quot;ara-exec-api&quot;</div><div class="line"></div><div class="line">inherit cmake</div><div class="line"></div><div class="line">EXTRA_OECMAKE += &quot;\</div><div class="line">    -DCMAKE_INSTALL_PREFIX=/ \</div><div class="line">&quot;</div><div class="line"></div><div class="line">python do_package_qa() {</div><div class="line">   pass</div><div class="line">}</div><div class="line">#RDEPENDS_${PN} += &quot;ara-vsomeipd&quot;</div><div class="line"></div><div class="line"># Add test applications to package</div><div class="line">FILES_${PN} += &quot;\</div><div class="line">        /opt/testapp \</div><div class="line">        /opt/Driving \</div><div class="line">        /opt/Parking \</div><div class="line">        /opt/Leaving \</div><div class="line">&quot;</div><div class="line"></div><div class="line">FILES_${PN}-dbg += &quot;\</div><div class="line">        /opt/testapp/bin/.debug \</div><div class="line">        /opt/Driving/bin/.debug \</div><div class="line">        /opt/Parking/bin/.debug \</div><div class="line">        /opt/Leaving/bin/.debug \</div><div class="line">        &quot;</div><div class="line"></div><div class="line">do_install_append() {</div><div class="line">  mkdir ${D}/opt/testapp/run/</div><div class="line">  mkdir ${D}/opt/Driving/run/</div><div class="line">  mkdir ${D}/opt/Parking/run/</div><div class="line">  mkdir ${D}/opt/Leaving/run/</div><div class="line">  mkfifo -m 0666 ${D}/opt/testapp/run/sysstate-client-fifo</div><div class="line">  mkfifo -m 0666 ${D}/opt/Driving/run/sysstate-client-fifo</div><div class="line">  mkfifo -m 0666 ${D}/opt/Parking/run/sysstate-client-fifo</div><div class="line">  mkfifo -m 0666 ${D}/opt/Leaving/run/sysstate-client-fifo</div><div class="line">}</div></div><!-- fragment --><h3>Creating new image image for Execution manager demonstration</h3>
<p>Add the application in core-image-apd-minimal.bb file below rootfs-open in IMAGE_INSTALL</p>
<blockquote class="doxtable">
<p>$ cd /ara-project/yocto-layers/meta-ara/recipes-core/images </p>
</blockquote>
<blockquote class="doxtable">
<p>$ vi core-image-apd-minimal_test.bb </p>
</blockquote>
<div class="fragment"><div class="line">include core-image-apd-minimal_test.bb</div><div class="line">DECRIPTION = &quot;A small image to ddemonstrate execution manager&quot;</div><div class="line">IMAGE_INSTALL += &quot; demo&quot;</div></div><!-- fragment --><h3>Bitbaking the image</h3>
<p>Bitbake the image</p>
<blockquote class="doxtable">
<p>$ bitbake core-image-apd-minimal</p>
</blockquote>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="adaptiveplatform_root.html">Adaptive Platform Tutorials</a></li><li class="navelem"><a class="el" href="adaptive_executionmanagement.html">Execution Management</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
