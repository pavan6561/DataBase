<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adaptive Platform Demonstrator: Porting Adaptive Platform to Rocko</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adaptive Platform Demonstrator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_porting_rocko.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Porting Adaptive Platform to Rocko </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Checkout Adaptive platform and other BSPs</h2>
<ol type="1">
<li>Install the Pre-requisites <div class="fragment"><div class="line">$home: sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \</div><div class="line">                    build-essential chrpath socat libsdl1.2-dev xterm repo</div></div><!-- fragment --></li>
<li>Download the Adaptive platform demostrator 18-06 release <div class="fragment"><div class="line">$ mkdir fsl-auto-yocto-bsp</div><div class="line">&amp; cd fsl-auto-yocto-bsp</div><div class="line">$ fsl-auto-yocto-bsp$: git clone ssh://git@code.autosar.org/tf-apd/ara-api</div><div class="line">$ fsl-auto-yocto-bsp$: git clone ssh://git@code.autosar.org/tf-apd/sample-applications</div><div class="line">$ fsl-auto-yocto-bsp$: git clone ssh://git@code.autosar.org/tf-apd/yocto-layers</div><div class="line">$ fsl-auto-yocto-bsp$: git -C ara-api checkout  4f804c096d2b4d08b25badc4322ab02fe7484a5d</div><div class="line">$ fsl-auto-yocto-bsp$: git -C sample-applications checkout  e07a84a5e302a1cc54c170e04d9dd55ba73cbcc9</div><div class="line">$ fsl-auto-yocto-bsp$: git -C yocto-layers checkout  07d0731abf244fb1afa7b7787c0e54d11b7020a7</div></div><!-- fragment --></li>
</ol>
<h2>Changes required to run Adaptive platform on rocko</h2>
<blockquote class="doxtable">
<p><b>Note: Following changes are required in order to build an image on Rocko. Left hand side is the actual file and right hand side is the changes to be made.</b> </p>
</blockquote>
<ol type="1">
<li><p class="startli">Diagnostic functional cluster has few warnings during the compilation process and these warnings are treated as an error due to compiler option -Werror is used in CMakeLists.txt. In order to build image successfully, this option is removed from corresponding CMakeLists file.</p>
<p class="startli">Path: /ara-api/diag/CmakeLists.txt </p><div class="image">
<img src="Diag.png" alt="Diag.png"/>
<div class="caption">
/ara-api/diag/CmakeLists.txt</div></div>
</li>
<li><p class="startli">"Logger g_logINT" is a global variable of dlt which gets initialized even before the application gets forked, due to this execution manager gets stuck inside fork() API. Jira ticket - 6516 has been raised in this regard. In order to avoid this issue, following work around is applied in the logmanager.cpp file.</p>
<p class="startli">Path: /ara-api/log/src/ </p><div class="image">
<img src="logmanager.png" alt="logmanager.png"/>
<div class="caption">
/ara-api/log/src/logmanager.cpp</div></div>
 <div class="image">
<img src="logmanager1.png" alt="logmanager1.png"/>
<div class="caption">
/ara-api/log/src/logmanager.cpp</div></div>
</li>
<li><p class="startli">Boost components are used in the ara-per in order to optimize the performance. However, this component(Boost) is causing a build issue during linking process as it's not getting linked from the respective application receipe-sysroot. To remove dependency on Boost components used by ara-per, following changes have been made in the ara-per functional clusters.</p>
<p class="startli">Path: /ara-api/per/src/fileaccess/CmakeLists.txt </p><div class="image">
<img src="fileaccess.png" alt="fileaccess.png"/>
<div class="caption">
/ara-api/per/src/fileaccess/CmakeLists.txt</div></div>
<p> Path: /ara-api/per/src/key-value-storage/CmakeLists.txt </p><div class="image">
<img src="Keyvaluestorage.png" alt="Keyvaluestorage.png"/>
<div class="caption">
/ara-api/per/src/key-value-storage/CmakeLists.txt</div></div>
</li>
<li><p class="startli">SYSTEM is a component in the boost library which is not used by the ucm package manager and unit-test CMakeList.txt. In order to build image successfully, SYSTEM component is removed from the respective CMakeLists.txt.</p>
<p class="startli">Path: /ara-api/ucm/pkgmgr/src/CmakeLists.txt </p><div class="image">
<img src="pkgmgr.png" alt="pkgmgr.png"/>
<div class="caption">
/ara-api/ucm/pkgmgr/src/CmakeLists.txt</div></div>
<p> Path: /ara-api/ucm/pkgmgr/src/test/unit_test/CmakeLists.txt </p><div class="image">
<img src="pkgmgr1.png" alt="pkgmgr1.png"/>
<div class="caption">
/ara-api/ucm/pkgmgr/src/test/unit_test/CmakeLists.txt</div></div>
</li>
<li><p class="startli">This change is carried out to make Test-appl1 in emo-sample as machine client so that it can interact with Execution manager to change the Machine state.</p>
<p class="startli">Path: /sample-applications/emo_samples/MANIFEST-appl1.json </p><div class="image">
<img src="emo_samples.png" alt="emo_samples.png"/>
<div class="caption">
/sample-applications/emo_samples/MANIFEST-appl1.json</div></div>
</li>
<li><p class="startli">functional header file is added to resolve the dependency in the machine state manager.</p>
<p class="startli">Path: /sample-applications/st_scenarios/machine_state_manager/inc/i_ms_control_server.h </p><div class="image">
<img src="st_scenarios.png" alt="st_scenarios.png"/>
<div class="caption">
/sample-applications/st_scenarios/machine_state_manager/inc/i_ms_control_server.h</div></div>
<p> Path: /sample-applications/st_scenarios/machine_state_manager/inc/ms_client_manager.h </p><div class="image">
<img src="st_scenarios1.png" alt="st_scenarios1.png"/>
<div class="caption">
/sample-applications/st_scenarios/machine_state_manager/inc/ms_client_manager.h</div></div>
</li>
<li><p class="startli">lib-platform dependency is added in ara-com-lib recipe file in order to resolve dependency.</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/com/ara-com-lib_1.0.0.bb </p><div class="image">
<img src="recipes_ara_com.png" alt="recipes_ara_com.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/com/ara-com-lib_1.0.0.bb</div></div>
</li>
<li><p class="startli">coreutils-native dependency is added in the execution-manager.bb file. To remove auto start of Execution manager during boot process, few lines have been commented (optional).</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/exec/execution-manager.bb </p><div class="image">
<img src="recipes-ara-exec.png" alt="recipes-ara-exec.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/exec/execution-manager.bb</div></div>
</li>
<li><p class="startli">boost library dependency is added ara-iam recipe file</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/iam/ara-iam.bb </p><div class="image">
<img src="recipes-ara-iam.png" alt="recipes-ara-iam.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/iam/ara-iam.bb</div></div>
</li>
<li><p class="startli">Python library has been replaced with two libraries - python-native and python-lxml-native.</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/sample-applications/ara-com-example.inc </p><div class="image">
<img src="recipes-ara-sample-app.png" alt="recipes-ara-sample-app.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/sample-applications/ara-com-example.inc</div></div>
</li>
<li><p class="startli">coreutils-native dependency is added in the emo-sample.bb file.</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/sample-applications/emo-samples_1.0.0.bb </p><div class="image">
<img src="recipes-ara-sample-app-emo.png" alt="recipes-ara-sample-app-emo.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/sample-applications/emo-samples_1.0.0.bb</div></div>
</li>
<li><p class="startli">ara-com-gen has been replaced with ara-com-gen-native in ucm recipe file</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/ucm/ucm-package-manager.bb </p><div class="image">
<img src="recipes-ara-ucm.png" alt="recipes-ara-ucm.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/ucm/ucm-package-manager.bb</div></div>
</li>
<li><p class="startli">The inclusion of Machine State Manager is causing packaging issue and bitbake process gets stuck. In order to avoid hanging issue during bitbake process, Machine State Manager is removed while building an image. The ROOTFS_PKGMANAGE_BOOTSTRAP variable and any references to it have been removed from Yocto - Rocko version onwards. To remove auto start of Execution manager during boot process, few lines have been commented (optional).</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-core/images/core-image-apd-common.inc </p><div class="image">
<img src="core-image-apd-common.png" alt="core-image-apd-common.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-core/images/core-image-apd-common.inc</div></div>
</li>
<li><p class="startli">ara-rest library is dependent on gtest hence this is added in CMakeLists.txt and ara-rest-lib_1.0.0.bb.</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/rest/ara-rest-lib_1.0.0.bb </p><div class="image">
<img src="recipes-ara_rest_ara-rest-lib-bb.png" alt="recipes-ara_rest_ara-rest-lib-bb.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/rest/ara-rest-lib_1.0.0.bb</div></div>
<p> Path: /ara-api/rest/lib/ara_rest/CmakeLists.txt </p><div class="image">
<img src="ara_rest_CMakeLists.txt.png" alt="ara_rest_CMakeLists.txt.png"/>
<div class="caption">
/ara-api/rest/lib/ara_rest/CmakeLists.txt</div></div>
</li>
<li><p class="startli">INSTALL_INTERFACE modified the path variable, hence system libraries were not found during linking.</p>
<p class="startli">Path: /ara-api/per/src/kvsparser/CmakeLists.txt </p><div class="image">
<img src="kvsparser.png" alt="kvsparser.png"/>
<div class="caption">
/ara-api/per/src/kvsparser/CmakeLists.txt</div></div>
</li>
<li><p class="startli">INSTALL_INTERFACE modified the path variable, hence system libraries were not found during linking.</p>
<p class="startli">Path: /ara-api/per/src/kvstype/CmakeLists.txt </p><div class="image">
<img src="kvstype.png" alt="kvstype.png"/>
<div class="caption">
/ara-api/per/src/kvstype/CmakeLists.txt</div></div>
</li>
<li><p class="startli">do_package_qa caused the bitbaking to hang hence it has been commented.</p>
<p class="startli">Path: /yocto-layers/meta-ara/recipes-ara/sample-applications/machinestatemanager_1.0.0.bb </p><div class="image">
<img src="machinestatemanager-1.png" alt="machinestatemanager-1.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/sample-applications/machinestatemanager_1.0.0.bb</div></div>
<p> Path: /yocto-layers/meta-ara/recipes-ara/sample-applications/machinestatemanager_1.0.0.bb </p><div class="image">
<img src="machinestatemanager-2.png" alt="machinestatemanager-2.png"/>
<div class="caption">
/yocto-layers/meta-ara/recipes-ara/sample-applications/machinestatemanager_1.0.0.bb</div></div>
</li>
<li><p class="startli">INSTALL_INTERFACE modified the path variable, hence system libraries were not found during linking.</p>
<p class="startli">Path: /ara-api/per/src/manifestaccess/CmakeLists.txt </p><div class="image">
<img src="manifestaccess.png" alt="manifestaccess.png"/>
<div class="caption">
/ara-api/per/src/manifestaccess/CmakeLists.txt</div></div>
</li>
<li><p class="startli">When an application tries to call the Update() method in "vsomeip_event_impl.h" where the queue is empty, the application will crashes (sporadic crashes) when trying to access a map object at /com/src/internal/e2e/e2e_binding.cpp line 84(Jira Ticket - AP-6292).</p>
<p class="startli">Path: ara-api/com/include/public/ara/com/internal/vsomeip/proxy/vsomeip_event_impl.h </p><div class="image">
<img src="vsomeip_event_impl.h.png" alt="vsomeip_event_impl.h.png"/>
<div class="caption">
/ara-api/com/include/public/ara/com/internal/vsomeip/proxy/vsomeip_event_impl.h</div></div>
 <h2>Porting Adaptive platform to NXP s3v234sbc</h2>
</li>
</ol>
<ol type="1">
<li>Download NXP bsp along with rocko verison of poky and compiler. <div class="fragment"><div class="line">cd fsl-auto-yocto-bsp</div><div class="line">$fsl-auto-yocto-bsp: repo init -u https://source.codeaurora.org/external/autobsps32/auto_yocto_bsp -b alb/master</div><div class="line">$fsl-auto-yocto-bsp: repo sync</div></div><!-- fragment --></li>
<li>First time setup <div class="fragment"><div class="line">$fsl-auto-yocto-bsp: ./sources/meta-alb/scripts/host-prepare.sh</div></div><!-- fragment --> <div class="fragment"><div class="line">! Note: When you run the host script you will see the following prompt.</div></div><!-- fragment --> <div class="image">
<img src="hostScript.png" alt="hostScript.png"/>
<div class="caption">
Host Script</div></div>
 <div class="fragment"><div class="line">The line that is highlighted in the image has to be added in the sudoer file. To add the command in sudoer follow the steps given below.</div><div class="line">1. Copy the command in your terminal as it can change in different host </div><div class="line">2. Enter the command:  sudo /usr/sbin/visudo</div><div class="line">3. Paste the line in user priviledge section.</div><div class="line">4. Then press ctrl+x, it will prompt whether to save so press yes.</div><div class="line">5. Now press ctrl+m+a.</div></div><!-- fragment --></li>
<li>Creating Build Directories. <div class="fragment"><div class="line">$fsl-auto-yocto-bsp: source nxp-setup-alb.sh -m s32v234sbc</div></div><!-- fragment --></li>
<li>if sourcing for the second time <div class="fragment"><div class="line">$fsl-auto-yocto-bsp: source build_s32v234sbc/SOURCE_THIS</div></div><!-- fragment --></li>
<li>Add the adaptive layer in bblayer.conf <div class="fragment"><div class="line">$fsl-auto-yocto-bsp/build_s32v234sbc: bitbake-layers add-layer ../yocto-layers/meta-ara</div></div><!-- fragment --></li>
<li>Add fsl-image-auto in local.conf <div class="fragment"><div class="line">$fsl-auto-yocto-bsp/build_s32v234sbc: echo &quot;IMAGE_INSTALL_append ??= \&quot;fsl-image-auto\&quot;&quot; &gt;&gt; conf/local.conf </div></div><!-- fragment --></li>
<li>Bitbake the core-image-apd-minimal <div class="fragment"><div class="line">$fsl-auto-yocto-bsp/build_s32v234sbc: bitbake core-image-apd-minimal-radar</div></div><!-- fragment --></li>
<li>Flash image in SD cards. <div class="fragment"><div class="line">$fsl-auto-yocto-bsp/build_s32v234sbc: cd  tmp/deploy/images/s32v234sbc</div><div class="line">$fsl-auto-yocto-bsp/build_s32v234sbc/tmp/deploy/images/s32v234sbc: sudo dd if=&quot;image name&quot;.sdcard of=/dev/&quot;dev&quot; name bs=1M &amp;&amp; sync</div></div><!-- fragment --> <blockquote class="doxtable">
<p>for example "image name" = core-image-apd-minimal-radar-s32v234sbc-2018101181325204-rootfs.sdcard</p>
<p>"dev name" = sdb1, sdb, mmbclk0 (check the dev name in Disk utility) </p>
</blockquote>
</li>
<li>For log, connect the micro-usb to host machine and run the below command on new terminal <div class="fragment"><div class="line">$home: sudo picocom -b 115200 /dev/ttyUSB0</div></div><!-- fragment --></li>
<li>Insert the SD card, press the reset button and it will boot automatically. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<style>
.footerWrap {
    width:100%;
    bottom: 0px;
}
.footer {
    width:400px;
    margin:auto;
}
.footerContent {
    float:left;
    width:100%;
}
.footer1 {
    margin-right:30px;
}
.footerContent1 {
    float:right;
}
.footer p {float:left; width:100%; text-align:center; }
</style>
<div class="footerWrap">
    <div class="footer">
      <div class="footerContent">
        <p>AVIN Systems Private Limited</p>
      </div>     
    </div>
	<div class="footer1">
      <div class="footerContent1">
        <p>Version 1.0.1</p>
      </div>     
    </div>
</div>
