<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adaptive Platform Demonstrator: Architecture Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adaptive Platform Demonstrator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_architecture__design.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Architecture Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>1. Static View</h1>
<h2>1.1 Software Architecture</h2>
<div class="image">
<img src="Software_Architecture.png" alt="Software_Architecture.png"/>
<div class="caption">
Figure No.1 Software Architecture</div></div>
<p> The above figure explains Adaptive Platform architecture logical view. The Adaptive Applications (AA) run on top of ARA (AUTOSAR Runtime for Adaptive Applications). ARA consists of application interfaces provided by Functional Clusters, which belong to either Adaptive Platform Foundation or Adaptive Platform Services. Adaptive Platform Foundation provides fundamental functionalities whereas Adaptive Platform Services provide platform standard services.</p>
<h2>1.2 PHM Architecture</h2>
<div class="image">
<img src="PHM_Architecture.png" alt="PHM_Architecture.png"/>
<div class="caption">
Figure No.2 PHM Architecture</div></div>
<ul>
<li><p class="startli"><b>The Platform Health Management (PHM)</b> supervises the Applications and could trigger a Recovery Action in case any Supervised Entity fails. The Recovery Actions are defined by the integrator based on the software architecture requirements for the Platform Health Management and configured in Manifests. The PHM functionality is divided into two parts: PHM Library and PHM Daemon.</p>
<p class="startli">PHM Library is built and linked along with Application and executed in the context of Adaptive Application process. PHM Daemon is executed as a separate process. Application reports health status or check points to PHM Library and PHM Library passes this information to PHM Daemon using IPC Socket Communication. PHM Daemon calculates Local Supervision Status based on supervised entities and later computes Global Supervision Status based on one or more Local Supervision Status. It arbitrates one or several Health channel (External and Internal-based on Global Supervision Status) and takes several actions to recover from fault.</p>
</li>
</ul>
<h1>Action Table</h1>
<table class="doxtable">
<tr>
<th align="center">Sl. No. </th><th align="left">Action Name </th><th align="left">Description </th><th align="left">Responsible </th><th align="left">Interface  </th></tr>
<tr>
<td align="center">1 </td><td align="left">TERMINATE_APP </td><td align="left">Terminate the running application </td><td align="left">State Management </td><td align="left">RequestState </td></tr>
<tr>
<td align="center">2 </td><td align="left">RESTART_APP </td><td align="left">Restart the running application </td><td align="left">Execution Management </td><td align="left">ProcessRestart </td></tr>
<tr>
<td align="center">3 </td><td align="left">RESET_PLATFORM_INSTANCE </td><td align="left">Shutdown and Restart the partition/ECU, based on the system. </td><td align="left">Execution Management </td><td align="left">EnterSafeState, RequestState </td></tr>
<tr>
<td align="center">4 </td><td align="left">WATCHDOG_RESET </td><td align="left">Stop refreshing the watchdog. </td><td align="left">So that after the configured (in watchdog driver) timeout the reset occurs. </td><td align="left">Watchdog Driver TriggerWatchdog (implementation specific) </td></tr>
</table>
<ul>
<li><p class="startli"><b>State Management</b> is responsible to determine the operation state, based on information received or gathered from other Adaptive Applications. State Management interacts with Execution Management to request Function Groups and the Machine State to enter specific states that are determined to project requirement.</p>
<p class="startli">Platform Health Management requests State Manager to switch to a specified Machine, Function Group or Application state using <em>RequestState()</em> API.</p>
</li>
<li><b>Execution Management</b> is responsible for platform initialization and the startup and shutdown of Adaptive Application. It performs these tasks using information contained within one or more Manifest files. Platform Health Management requests Execution Manager to restart a specified process using <em>ProcessRestart()</em> API and request to force switching to a specified Machine or Function Group state using <em>EnterSafeState()</em> API.</li>
<li><p class="startli"><b>Diagnostic Management</b> intended to support an own diagnostic server instance per installed Software Cluster and this server is responsible for processing/dispatching of diagnostic services according to ISO 14229-1.</p>
<p class="startli">Platform Health Management reports error information to Diagnostic Manager. However, interface is not yet defined.</p>
</li>
<li><p class="startli"><b>HW Watchdog</b> offers watchdog timers as standalone devices for applications requiring a high security level. It will monitor software code execution, or hardware failures, and can trigger appropriate action, such as system reboot.</p>
<p class="startli">Platform Health Management requests the Watchdog driver to perform watchdog reset.</p>
</li>
<li><b>The Log and Trace (L&amp;T)</b> provides interface to forward logging information onto the communication bus, the console, or to the file system. Platform Health Management requests L&amp;T to log Local Supervision Status, Global Supervision Status, Arbitration Result etc.</li>
<li><b>Applications</b> can interact with Platform Health Management Library using <em>ReportHealthStatus()</em> and <em>ReportCheckPoint()</em> APIs. Safety Application can get the statuses from Platform Health Management Library using <em>GetLocalStatus()</em> and <em>GetGlobalStatus()</em> APIs.</li>
<li><b>Manifest file</b> is an input for Applications and Platform Health Management.</li>
</ul>
<h2>1.3 Interface between PHM and other functional clusters</h2>
<div class="image">
<img src="IFC_Interface.png" alt="IFC_Interface.png"/>
<div class="caption">
Figure No.3 Interface between PHM and other functional clusters</div></div>
<p> PHM interacts with other Functional Clusters like Execution Manager, State Manager etc. Above diagram shows the way PHM communicates with other functional clusters.</p>
<ul>
<li>PHM calls <em>GetAllProcessState()</em> of Execution Manager to determine if any Supervised Entity is activated or deactivated for specific time and it is notified by the Execution Manager by change in process state using <em>ProcessChanged()</em>.</li>
<li>PHM requests Execution Manager to restart a specified process using <em>RestartProcess()</em> API.</li>
<li>Requests the State Manager to switch to a specified Machine, FunctionGroup or Application state using <em>RequestState()</em> API.</li>
<li>Requests the Watchdog driver to perform a watchdog reset (implementation specific API).</li>
<li>Reports error information to the Diagnostic Manager (interface not specified).</li>
</ul>
<h2>1.4 Configuration Methodology (Example)</h2>
<h3>1.4.1 Application Design Configuration</h3>
<div class="image">
<img src="App_Design_Configuration.png" alt="App_Design_Configuration.png"/>
<div class="caption">
Figure No.4 Application Design Configuration</div></div>
 <h3>1.4.2 PHM Configuration</h3>
<div class="image">
<img src="PHM_Configuration.png" alt="PHM_Configuration.png"/>
<div class="caption">
Figure No.5 PHM Configuration</div></div>
 <h3>1.4.3 PHM Instance Reference</h3>
<div class="image">
<img src="HealthChannel_phm_instance_reference.png" alt="HealthChannel_phm_instance_reference.png"/>
<div class="caption">
Figure No.6 PHM Instance Reference for Health Channel</div></div>
<div class="image">
<img src="checkpoint_phm_instance_reference.png" alt="checkpoint_phm_instance_reference.png"/>
<div class="caption">
Figure No.7 PHM Instance Reference for Supervised Entity</div></div>
 <h3>1.4.4 Logical Expression</h3>
<div class="image">
<img src="modeling_of_Phm_expression_configuration.png" alt="modeling_of_Phm_expression_configuration.png"/>
<div class="caption">
Figure No.8 Logical Expression</div></div>
 <h3>1.4.5 Arbitration</h3>
<div class="image">
<img src="Rules&Actions.png" alt="Rules&Actions.png"/>
<div class="caption">
Figure No.9 Arbitration</div></div>
 <h1>2. Dynamic View</h1>
<h2>2.1 Execution Flow</h2>
<div class="image">
<img src="Executionflow.png" alt="Executionflow.png"/>
<div class="caption">
Figure No.10 Execution Flow</div></div>
<ul>
<li><b>External Health Channels:</b> In above example, Voltage Monitoring Application and Temperature Monitoring Application are two External Health Channels. Their respective health status is shown in above figure. External Health Channel Status is used to perform Mode Arbitration.</li>
<li><p class="startli"><b>Local Supervision</b></p>
<p class="startli">The Supervised Entities can be monitored using Local Supervision Status which is the aggregation of three Supervisions (Alive Supervision, Deadline Supervision, Logical Supervision).</p>
<p class="startli">During a monitoring cycle, the supervised entities configured in the running process are evaluated and the local status of each entity is updated based on the results of the evaluation. Based on the update in the local status the global status is also updated. If a failure occurs for a Supervised Entity, the failure counters are incremented till they reach the pre-configured threshold. If a threshold is reached the local status of the Supervised Entity is updated.</p>
<p class="startli">For more details refer <a class="el" href="_appendix.html#Local_Supervision_Status">Local Supervision Status</a>.</p>
</li>
<li><p class="startli"><b>Global Supervision</b></p>
<p class="startli">Global Supervision is computed based on Local Supervision Status of Supervised Entities. If the pre-configured Global Threshold counters exceed due to failure of the supervised entities Global Status is updated. It is mapped with Health Channel Status (Internal).</p>
<p class="startli">For more details refer <a class="el" href="_appendix.html#Global_Supervision_Status">Global Supervision Status</a>.</p>
</li>
<li><p class="startli"><b>Mode Arbitration</b></p>
<p class="startli">In Arbitration Part, Mode Values of one or multiple Health Channels make Logical Expression and depending on this Logical Expression result, configured action will be taken. Possible actions include restart of applications, or a state change within an application, function group or ECU.</p>
</li>
</ul>
<h2>2.2 Sequence Diagram</h2>
<div class="image">
<img src="Daemon_Connection.png" alt="Daemon_Connection.png"/>
<div class="caption">
Figure No.11 Sequence Diagram</div></div>
 <h2>2.3 Activity Diagram</h2>
<div class="image">
<img src="alive.png" alt="alive.png"/>
<div class="caption">
Figure No.12 Activity Diagram for Alive Supervision</div></div>
<ul>
<li>In Supervised Entity any number of checkpoints can be configured for Alive Supervision. For Alive Supervision, Supervise Entity calls <em>ReportCheckPoint()</em> with appropriate checkpoint id. This increments Alive counter for the checkpoint.</li>
<li>Periodic checking of Alive counter happens at every Alive Reference Cycle by Health Monitoring. This Alive Supervision Cycle is defined in attribute of Alive Supervision.</li>
<li>Health Monitoring examines the Alive counter if it is within margin (Expected Alive Indication - Min Margin; Expected Alive Indication + Max Margin) or not. These Margin parameters also defined in configuration of Alive Supervision.</li>
<li>Expected Alive Indication is amount of expected Alive indication of checkpoint. Min Margin and Max margin are allowed tolerance of expected indication. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="adaptiveplatform_root.html">Adaptive Platform Tutorials</a></li><li class="navelem"><a class="el" href="_guideline__document_for__platform__health__management.html">Platform Health Management</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
